{% block title %}Final Results - Mental Fatigue Experiment{% endblock %}

{% block content %}

<style>
    body {
        background-color: #FFFFFF;
        font-family: Arial, Helvetica, sans-serif;
        padding: 20px;
        max-width: 1000px;
        margin: 0 auto;
    }

    .completion-header {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 40px;
        border-radius: 15px;
        text-align: center;
        margin-bottom: 30px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .summary-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background-color: #f8f9fa;
        border: 2px solid #e9ecef;
        border-radius: 10px;
        padding: 25px;
        text-align: center;
        transition: transform 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }

    .stat-value {
        font-size: 36px;
        font-weight: bold;
        color: #007bff;
        display: block;
        margin-bottom: 10px;
    }

    .stat-label {
        font-size: 14px;
        color: #666;
        text-transform: uppercase;
        font-weight: bold;
    }

    .sessions-table {
        background-color: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin: 30px 0;
    }

    .table-header {
        background-color: #007bff;
        color: white;
        padding: 20px;
        text-align: center;
        font-size: 20px;
        font-weight: bold;
    }

    .session-row {
        display: grid;
        grid-template-columns: 1fr 2fr 1fr 1fr 1fr 1fr;
        padding: 15px 20px;
        border-bottom: 1px solid #e9ecef;
        align-items: center;
    }

    .session-row:nth-child(even) {
        background-color: #f8f9fa;
    }

    .session-row:hover {
        background-color: #e3f2fd;
    }

    .row-header {
        background-color: #6c757d;
        color: white;
        font-weight: bold;
        grid-template-columns: 1fr 2fr 1fr 1fr 1fr 1fr;
    }

    .role-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        text-align: center;
    }

    .role-recruiter { background-color: #17a2b8; color: white; }
    .role-hr { background-color: #28a745; color: white; }
    .role-business { background-color: #ffc107; color: black; }

    .trend-analysis {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 30px 0;
    }

    .trend-card {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 10px;
        padding: 20px;
    }

    .trend-title {
        font-size: 18px;
        font-weight: bold;
        color: #333;
        margin-bottom: 15px;
        text-align: center;
    }

    .trend-indicator {
        font-size: 24px;
        font-weight: bold;
        text-align: center;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
    }

    .trend-positive {
        background-color: #d4edda;
        color: #155724;
    }

    .trend-negative {
        background-color: #f8d7da;
        color: #721c24;
    }

    .trend-stable {
        background-color: #fff3cd;
        color: #856404;
    }

    .debriefing {
        background-color: #e8f5e8;
        border: 2px solid #28a745;
        border-radius: 10px;
        padding: 30px;
        margin: 30px 0;
    }

    .thank-you {
        background-color: #e3f2fd;
        border: 2px solid #2196f3;
        border-radius: 10px;
        padding: 30px;
        margin: 30px 0;
        text-align: center;
    }

    h1, h2, h3 {
        margin-top: 0;
    }

    .completion-badge {
        display: inline-block;
        background-color: rgba(255, 255, 255, 0.2);
        padding: 10px 20px;
        border-radius: 25px;
        font-size: 16px;
        margin: 10px 0;
    }
</style>

<div class="completion-header">
    <h1> Experiment Complete!</h1>
    <div class="completion-badge">Mental Fatigue Study - All {{ total_sessions_completed }} Sessions Completed</div>
    <p>Thank you for your participation in this comprehensive study</p>
</div>

<!-- Summary Statistics -->
<div class="summary-stats">
    <div class="stat-card">
        <span class="stat-value">{{ total_sessions_completed }}</span>
        <div class="stat-label">Sessions Completed</div>
    </div>
    <div class="stat-card">
        <span class="stat-value" id="avgFatigue">{{ average_fatigue }}</span>
        <div class="stat-label">Average Fatigue Level</div>
    </div>
    <div class="stat-card">
        <span class="stat-value" id="fatigueChange">{{ fatigue_increase }}</span>
        <div class="stat-label">Fatigue Change</div>
    </div>
    <div class="stat-card">
        <span class="stat-value" id="cognitiveChange">{{ cognitive_decline }}</span>
        <div class="stat-label">Performance Change</div>
    </div>
</div>

<!-- Session Details Table -->
<div class="sessions-table">
    <div class="table-header">
         Session-by-Session Results
    </div>

    <div class="session-row row-header">
        <div><strong>Session</strong></div>
        <div><strong>Role</strong></div>
        <div><strong>Fatigue</strong></div>
        <div><strong>Mental Effort</strong></div>
        <div><strong>Concentration</strong></div>
        <div><strong>Motivation</strong></div>
    </div>

    {% for session in all_sessions %}
    <div class="session-row">
        <div><strong>{{ session.session }}</strong></div>
        <div>
            <span class="role-badge
                {% if session.role == 'Recruiter' %}role-recruiter
                {% elif session.role == 'HR-Coordinator' %}role-hr
                {% elif session.role == 'Business-Partner' %}role-business
                {% endif %}">
                {{ session.role }}
            </span>
        </div>
        <div class="session-data" data-fatigue="{{ session.fatigue_level }}">{{ session.fatigue_level }}/10</div>
        <div class="session-data" data-effort="{{ session.mental_effort }}">{{ session.mental_effort }}/10</div>
        <div class="session-data" data-concentration="{{ session.concentration_difficulty }}">{{ session.concentration_difficulty }}/10</div>
        <div class="session-data" data-motivation="{{ session.motivation_level }}">{{ session.motivation_level }}/10</div>
    </div>
    {% endfor %}
</div>

<!-- Trend Analysis -->
<div class="trend-analysis">
    <div class="trend-card">
        <div class="trend-title"> Fatigue Progression</div>
        {% if fatigue_increase > 1 %}
        <div class="trend-indicator trend-negative">
            ️ Significant Increase<br>
            <small id="fatigueIncrease1">+{{ fatigue_increase }} points</small>
        </div>
        <p>Your fatigue levels increased noticeably over the sessions, which is expected in sustained cognitive tasks.</p>
        {% elif fatigue_increase > -1 %}
        <div class="trend-indicator trend-stable">
            ️ Stable<br>
            <small id="fatigueIncrease2">{{ fatigue_increase }} points</small>
        </div>
        <p>Your fatigue levels remained relatively stable throughout the experiment.</p>
        {% else %}
        <div class="trend-indicator trend-positive">
            ️ Decreased<br>
            <small id="fatigueIncrease3">{{ fatigue_increase }} points</small>
        </div>
        <p>Interestingly, your fatigue levels decreased over time, possibly due to task adaptation.</p>
        {% endif %}
    </div>

    <div class="trend-card">
        <div class="trend-title"> Cognitive Performance</div>
        {% if cognitive_decline > 1 %}
        <div class="trend-indicator trend-negative">
            ️ Performance Decline<br>
            <small id="cognitiveDecline1">-{{ cognitive_decline }} points</small>
        </div>
        <p>Your cognitive performance declined over sessions, indicating mental fatigue effects.</p>
        {% elif cognitive_decline > -1 %}
        <div class="trend-indicator trend-stable">
             Stable Performance<br>
            <small id="cognitiveDecline2">{{ cognitive_decline }} points</small>
        </div>
        <p>Your cognitive performance remained consistent throughout the experiment.</p>
        {% else %}
        <div class="trend-indicator trend-positive">
            ️ Performance Improved<br>
            <small id="cognitiveDecline3">+{{ cognitive_decline }} points</small>
        </div>
        <p>Your cognitive performance improved over time, showing learning effects.</p>
        {% endif %}
    </div>
</div>

<!-- Research Context -->
<div class="debriefing">
    <h3> About This Research</h3>
    <p><strong>Purpose:</strong> This study investigated how mental fatigue develops during extended collaborative work sessions and how it affects cognitive performance.</p>

    <p><strong>Your Contribution:</strong> Your data will help researchers understand:</p>
    <ul>
        <li>How fatigue accumulates during digital collaboration</li>
        <li>The relationship between subjective fatigue and objective performance</li>
        <li>Individual differences in fatigue resistance and recovery</li>
        <li>The impact of role-switching on mental workload</li>
    </ul>

    <p><strong>Key Findings from Your Sessions:</strong></p>
    <ul>
        <li>You completed {{ total_sessions_completed }} full collaborative sessions</li>
        <li>Your fatigue levels {% if fatigue_increase > 0 %}increased{% elif fatigue_increase < 0 %}decreased{% else %}remained stable{% endif %} over time</li>
        <li>Your cognitive performance {% if cognitive_decline > 0 %}declined{% elif cognitive_decline < 0 %}improved{% else %}remained stable{% endif %} across sessions</li>
    </ul>
</div>

<!-- Thank You -->
<div class="thank-you">
    <h2> Thank You!</h2>
    <p><strong>Your participation is invaluable for advancing our understanding of mental fatigue in digital work environments.</strong></p>

    <p>The data you provided will contribute to:</p>
    <ul style="text-align: left; display: inline-block;">
        <li>Designing better break schedules for knowledge workers</li>
        <li>Developing fatigue-aware collaboration tools</li>
        <li>Understanding optimal task rotation strategies</li>
        <li>Creating personalized workload management systems</li>
    </ul>

    <p><em>If you have any questions about this research, please contact the research team.</em></p>

    <div style="margin-top: 30px;">
        <strong>Experiment ID:</strong> {{ player.participant.code }}<br>
        <strong>Completion Date:</strong> <span id="completionDate"></span>
    </div>
</div>

<script>
// Format numbers and display current date
document.addEventListener('DOMContentLoaded', function() {
    // Format floating point numbers to 1 decimal place
    const avgFatigue = {{ average_fatigue }};
    const fatigueIncrease = {{ fatigue_increase }};
    const cognitiveDecline = {{ cognitive_decline }};

    // Update average fatigue
    const avgElement = document.getElementById('avgFatigue');
    if (avgElement) {
        avgElement.textContent = avgFatigue.toFixed(1);
    }

    // Update fatigue change with + sign if positive
    const fatigueElement = document.getElementById('fatigueChange');
    if (fatigueElement) {
        const formattedFatigue = fatigueIncrease.toFixed(1);
        fatigueElement.textContent = fatigueIncrease > 0 ? '+' + formattedFatigue : formattedFatigue;
    }

    // Update cognitive change with - sign if positive (decline)
    const cognitiveElement = document.getElementById('cognitiveChange');
    if (cognitiveElement) {
        const formattedCognitive = cognitiveDecline.toFixed(1);
        cognitiveElement.textContent = cognitiveDecline > 0 ? '-' + formattedCognitive : formattedCognitive;
    }

    // Update trend descriptions
    const fatigue1 = document.getElementById('fatigueIncrease1');
    if (fatigue1) fatigue1.textContent = '+' + fatigueIncrease.toFixed(1) + ' points';

    const fatigue2 = document.getElementById('fatigueIncrease2');
    if (fatigue2) fatigue2.textContent = fatigueIncrease.toFixed(1) + ' points';

    const fatigue3 = document.getElementById('fatigueIncrease3');
    if (fatigue3) fatigue3.textContent = fatigueIncrease.toFixed(1) + ' points';

    const cognitive1 = document.getElementById('cognitiveDecline1');
    if (cognitive1) cognitive1.textContent = '-' + cognitiveDecline.toFixed(1) + ' points';

    const cognitive2 = document.getElementById('cognitiveDecline2');
    if (cognitive2) cognitive2.textContent = cognitiveDecline.toFixed(1) + ' points';

    const cognitive3 = document.getElementById('cognitiveDecline3');
    if (cognitive3) cognitive3.textContent = '+' + Math.abs(cognitiveDecline).toFixed(1) + ' points';

    // Fix session data display - replace empty/null values with "-"
    const sessionDataElements = document.querySelectorAll('.session-data');
    sessionDataElements.forEach(function(element) {
        const text = element.textContent.trim();
        // Check if it contains "null", "None", "undefined" or just "/10"
        if (text === 'null/10' || text === 'None/10' || text === '/10' || text === 'undefined/10' || text.startsWith('null') || text.startsWith('None')) {
            element.textContent = '-';
        }
    });

    // Display current date
    const now = new Date();
    const dateString = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
    const dateElement = document.getElementById('completionDate');
    if (dateElement) {
        dateElement.textContent = dateString;
    }
});
</script>

{% endblock %}