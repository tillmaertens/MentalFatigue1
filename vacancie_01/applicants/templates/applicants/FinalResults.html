{% block title %}Final Results - Mental Fatigue Experiment{% endblock %}

{% block content %}
<style>
    body {
        background-color: #FFFFFF;
        font-family: Arial, sans-serif;
        padding: 20px;
        max-width: 1000px;
        margin: 0 auto;
        color: #333;
    }

    .completion-header {
        background-color: #f8f9fa;
        padding: 40px;
        border-radius: 5px;
        text-align: center;
        margin-bottom: 30px;
        border: 1px solid #dee2e6;
    }

    .completion-header h1 {
        color: #333;
        margin: 0 0 15px 0;
    }

    .completion-badge {
        background-color: white;
        padding: 10px 20px;
        border-radius: 5px;
        font-size: 16px;
        margin: 10px 0;
        display: inline-block;
        border: 1px solid #e9ecef;
    }

    .summary-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 25px;
        text-align: center;
    }

    .stat-value {
        font-size: 36px;
        font-weight: bold;
        color: #007bff;
        display: block;
        margin-bottom: 10px;
    }

    .stat-label {
        font-size: 14px;
        color: #666;
        text-transform: uppercase;
        font-weight: bold;
    }

    .sessions-table {
        background-color: white;
        border-radius: 5px;
        overflow: hidden;
        border: 1px solid #dee2e6;
        margin: 30px 0;
    }

    .table-header {
        background-color: #f8f9fa;
        padding: 20px;
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        border-bottom: 1px solid #dee2e6;
    }

    .session-row {
        display: grid;
        grid-template-columns: 1fr 2fr 1fr 1fr 1fr 1fr;
        padding: 15px 20px;
        border-bottom: 1px solid #e9ecef;
        align-items: center;
    }

    .session-row:nth-child(even) {
        background-color: #f8f9fa;
    }

    .row-header {
        background-color: #e9ecef;
        font-weight: bold;
        border-bottom: 2px solid #dee2e6;
    }

    .role-badge {
        display: inline-block;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        text-align: center;
        background-color: #007bff;
        color: white;
    }

    .trend-analysis {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin: 30px 0;
    }

    .trend-card {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 20px;
    }

    .trend-title {
        font-size: 18px;
        font-weight: bold;
        color: #333;
        margin-bottom: 15px;
        text-align: center;
    }

    .trend-indicator {
        font-size: 24px;
        font-weight: bold;
        text-align: center;
        padding: 15px;
        border-radius: 5px;
        margin: 10px 0;
        background-color: white;
        border: 1px solid #e9ecef;
    }

    .trend-positive {
        color: #28a745;
    }

    .trend-negative {
        color: #dc3545;
    }

    .trend-stable {
        color: #6c757d;
    }

    .debriefing {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 30px;
        margin: 30px 0;
    }

    .debriefing h3 {
        color: #333;
        margin-top: 0;
    }

    .debriefing ul {
        margin: 15px 0;
        padding-left: 20px;
    }

    .debriefing li {
        margin: 8px 0;
        color: #555;
    }

    .thank-you {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 5px;
        padding: 30px;
        margin: 30px 0;
        text-align: center;
    }

    .thank-you h2 {
        color: #333;
        margin-top: 0;
    }

    .thank-you ul {
        text-align: left;
        display: inline-block;
        margin: 20px 0;
    }

    .experiment-info {
        margin-top: 30px;
        padding: 20px;
        background-color: white;
        border-radius: 5px;
        border: 1px solid #e9ecef;
    }
</style>

<div class="completion-header">
    <h1>Experiment Complete</h1>
    <div class="completion-badge">Mental Fatigue Study - All {{ total_sessions_completed }} Sessions Completed</div>
    <p>Thank you for your participation in this comprehensive study</p>
</div>

<div class="summary-stats">
    <div class="stat-card">
        <span class="stat-value">{{ total_sessions_completed }}</span>
        <div class="stat-label">Sessions Completed</div>
    </div>
    <div class="stat-card">
        <span class="stat-value" id="avgFatigue">{{ average_fatigue }}</span>
        <div class="stat-label">Average Fatigue Level</div>
    </div>
    <div class="stat-card">
        <span class="stat-value" id="fatigueChange">{{ fatigue_increase }}</span>
        <div class="stat-label">Fatigue Change</div>
    </div>
    <div class="stat-card">
        <span class="stat-value" id="cognitiveChange">{{ cognitive_decline }}</span>
        <div class="stat-label">Performance Change</div>
    </div>
</div>

<div class="sessions-table">
    <div class="table-header">
        Session-by-Session Results
    </div>

    <div class="session-row row-header">
        <div><strong>Session</strong></div>
        <div><strong>Role</strong></div>
        <div><strong>Fatigue</strong></div>
        <div><strong>Mental Effort</strong></div>
        <div><strong>Concentration</strong></div>
        <div><strong>Motivation</strong></div>
    </div>

    {% for session in all_sessions %}
    <div class="session-row">
        <div><strong>{{ session.session }}</strong></div>
        <div>
            <span class="role-badge">{{ session.role }}</span>
        </div>
        <div class="session-data" data-fatigue="{{ session.fatigue_level }}">{{ session.fatigue_level }}/10</div>
        <div class="session-data" data-effort="{{ session.mental_effort }}">{{ session.mental_effort }}/10</div>
        <div class="session-data" data-concentration="{{ session.concentration_difficulty }}">{{ session.concentration_difficulty }}/10</div>
        <div class="session-data" data-motivation="{{ session.motivation_level }}">{{ session.motivation_level }}/10</div>
    </div>
    {% endfor %}
</div>

<div class="trend-analysis">
    <div class="trend-card">
        <div class="trend-title">Fatigue Progression</div>
        {% if fatigue_increase > 1 %}
        <div class="trend-indicator trend-negative">
            Significant Increase<br>
            <small id="fatigueIncrease1">+{{ fatigue_increase }} points</small>
        </div>
        <p>Your fatigue levels increased noticeably over the sessions.</p>
        {% elif fatigue_increase > -1 %}
        <div class="trend-indicator trend-stable">
            Stable<br>
            <small id="fatigueIncrease2">{{ fatigue_increase }} points</small>
        </div>
        <p>Your fatigue levels remained relatively stable throughout the experiment.</p>
        {% else %}
        <div class="trend-indicator trend-positive">
            Decreased<br>
            <small id="fatigueIncrease3">{{ fatigue_increase }} points</small>
        </div>
        <p>Your fatigue levels decreased over time.</p>
        {% endif %}
    </div>

    <div class="trend-card">
        <div class="trend-title">Cognitive Performance</div>
        {% if cognitive_decline > 1 %}
        <div class="trend-indicator trend-negative">
            Performance Decline<br>
            <small id="cognitiveDecline1">-{{ cognitive_decline }} points</small>
        </div>
        <p>Your cognitive performance declined over sessions, indicating mental fatigue effects.</p>
        {% elif cognitive_decline > -1 %}
        <div class="trend-indicator trend-stable">
            Stable Performance<br>
            <small id="cognitiveDecline2">{{ cognitive_decline }} points</small>
        </div>
        <p>Your cognitive performance remained consistent throughout the experiment.</p>
        {% else %}
        <div class="trend-indicator trend-positive">
            Performance Improved<br>
            <small id="cognitiveDecline3">+{{ cognitive_decline }} points</small>
        </div>
        <p>Your cognitive performance improved over time, showing learning effects.</p>
        {% endif %}
    </div>
</div>

<div class="debriefing">
    <h3>About This Research</h3>
    <p><strong>Purpose:</strong> This study investigated how mental fatigue develops during extended collaborative work sessions and how it affects cognitive performance.</p>

    <p><strong>Your Contribution:</strong> Your data will help researchers understand:</p>
    <ul>
        <li>How fatigue accumulates during digital collaboration</li>
    </ul>

    <p><strong>Key Findings from Your Sessions:</strong></p>
    <ul>
        <li>You completed {{ total_sessions_completed }} full collaborative sessions</li>
        <li>Your fatigue levels {% if fatigue_increase > 0 %}increased{% elif fatigue_increase < 0 %}decreased{% else %}remained stable{% endif %} over time</li>
        <li>Your cognitive performance {% if cognitive_decline > 0 %}declined{% elif cognitive_decline < 0 %}improved{% else %}remained stable{% endif %} across sessions</li>
    </ul>
</div>

<div class="thank-you">
    <h2>Thank You</h2>
    <p><strong>Your participation is invaluable for advancing our understanding of mental fatigue in digital work environments.</strong></p>

    <!-- Optional -->
    <p>The data you provided will contribute to:</p>
    <ul>
        <li>Designing better break schedules for knowledge workers</li>
        <li>Developing fatigue-aware collaboration tools</li>
        <li>Understanding optimal task rotation strategies</li>
        <li>Creating personalized workload management systems</li>
    </ul>

    <p><em>If you have any questions about this research, please contact the research team.</em></p>

    <div class="experiment-info">
        <strong>Experiment ID:</strong> {{ player.participant.code }}<br>
        <strong>Completion Date:</strong> <span id="completionDate"></span>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const avgFatigue = {{ average_fatigue }};
    const fatigueIncrease = {{ fatigue_increase }};
    const cognitiveDecline = {{ cognitive_decline }};

    const avgElement = document.getElementById('avgFatigue');
    if (avgElement) {
        avgElement.textContent = avgFatigue.toFixed(1);
    }

    const fatigueElement = document.getElementById('fatigueChange');
    if (fatigueElement) {
        const formattedFatigue = fatigueIncrease.toFixed(1);
        fatigueElement.textContent = fatigueIncrease > 0 ? '+' + formattedFatigue : formattedFatigue;
    }

    const cognitiveElement = document.getElementById('cognitiveChange');
    if (cognitiveElement) {
        const formattedCognitive = cognitiveDecline.toFixed(1);
        cognitiveElement.textContent = cognitiveDecline > 0 ? '-' + formattedCognitive : formattedCognitive;
    }

    const fatigue1 = document.getElementById('fatigueIncrease1');
    if (fatigue1) fatigue1.textContent = '+' + fatigueIncrease.toFixed(1) + ' points';

    const fatigue2 = document.getElementById('fatigueIncrease2');
    if (fatigue2) fatigue2.textContent = fatigueIncrease.toFixed(1) + ' points';

    const fatigue3 = document.getElementById('fatigueIncrease3');
    if (fatigue3) fatigue3.textContent = fatigueIncrease.toFixed(1) + ' points';

    const cognitive1 = document.getElementById('cognitiveDecline1');
    if (cognitive1) cognitive1.textContent = '-' + cognitiveDecline.toFixed(1) + ' points';

    const cognitive2 = document.getElementById('cognitiveDecline2');
    if (cognitive2) cognitive2.textContent = cognitiveDecline.toFixed(1) + ' points';

    const cognitive3 = document.getElementById('cognitiveDecline3');
    if (cognitive3) cognitive3.textContent = '+' + Math.abs(cognitiveDecline).toFixed(1) + ' points';

    const sessionDataElements = document.querySelectorAll('.session-data');
    sessionDataElements.forEach(function(element) {
        const text = element.textContent.trim();
        if (text === 'null/10' || text === 'None/10' || text === '/10' || text === 'undefined/10' || text.startsWith('null') || text.startsWith('None')) {
            element.textContent = '-';
        }
    });

    const now = new Date();
    const dateString = now.toLocaleDateString() + ' ' + now.toLocaleTimeString();
    const dateElement = document.getElementById('completionDate');
    if (dateElement) {
        dateElement.textContent = dateString;
    }
});
</script>

{% endblock %}